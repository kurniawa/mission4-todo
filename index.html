<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do List</title>
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-100 p-4 text-slate-600 text-xs">
  <div class="max-w-xl mx-auto min-h-1/2 border border-slate-300 bg-white shadow p-3">
    <!-- Input for Name and Position -->
    <div id="user-info-wrapper">
      <div id="user-info" class="flex justify-end">
        <div class="border-b border-slate-300 hover:cursor-pointer">
          <span class="text-indigo-400 font-bold">Name and Position</span>
          <span class="text-orange-500">(Click to edit)</span>
        </div>
      </div>

      <div id="form-user-info" class="flex gap-1 mt-2">
        <input id="name" type="text" placeholder="Name" class="w-full p-2 border border-slate-300 rounded">
        <input id="position" type="text" placeholder="Position" class="w-full p-2 border border-slate-300 rounded">
        <button id="cancelSaveUser" class="bg-rose-400 text-white px-4 py-2 rounded hover:cursor-pointer">Cancel</button>
        <button id="saveUser" class="bg-blue-400 text-white px-4 py-2 rounded hover:cursor-pointer">Save</button>
      </div>
    </div>

    <!-- Input for To-Do -->
    <div class="mt-5">
      <div class="">
        <div class="border border-slate-300 p-1 flex gap-1 flex-wrap">
          <div class="flex-grow">
            <input id="todoTitle" type="text" placeholder="To do" class="p-2 w-full">
          </div>
          <div class="flex items-center">
            <span>Priority:</span>
          </div>
          <select id="todoPriority" class="border border-slate-300">
            <option value="Low">Low</option>
            <option value="Medium">Medium</option>
            <option value="High">High</option>
          </select>
          <button id="button-detail-todo" type="button" class="px-1 text-yellow-600 font-bold border-2 border-yellow-400 hover:cursor-pointer" onclick="toggleTodoDetail(this)">Detail</button>
          <button type="button" id="addTodo" class="px-1 bg-emerald-300 text-white font-bold border-2 border-emerald-400 hover:cursor-pointer">
            <span class="sm:hidden">Add</span>
            <span class="hidden sm:inline-block">Add To-do</span>
          </button>
        </div>
        <div id="div-todo-detail" class="hidden mt-1">
          <div class="flex gap-1">
            <textarea id="todoDetail" rows="3" placeholder="Detail" class="p-2 border border-slate-300 flex-grow"></textarea>
            <div class="">
              <div>
                <label for="begin">Begin:</label>
                <div><input id="todoDate" type="date" class="p-2 border border-slate-300"></div>
              </div>
              <div class="mt-2">
                <label for="due-date">Due date:</label>
                <div><input id="todoDueDate" type="date" class="p-2 border border-slate-300"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- To-Do Lists -->
    <div class="mt-5">
      <div id="activeTodoList">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Active To-Do List</h2>
        <div>
          <div class="flex gap-5">
            <div class="hidden" id="div-selectAllActive">
              <div class="flex gap-1 items-center">
                <input id="select-all-active" type="checkbox" onclick="selectAll(this, 'active')">
                <label for="select-all-active">Select All</label>
              </div>
            </div>
            <div id="options-select-active" class="hidden">
              <div class="flex gap-1">
                <button class="bg-emerald-300 text-white p-1 font-bold hover:cursor-pointer" onclick="markAsBySelected('active', 'done', false)" >Mark as done</button>
                <button class="bg-rose-300 text-white p-1 font-bold hover:cursor-pointer" onclick="markAsBySelected('active', null, true)" >Delete selected</button>
              </div>
            </div>
          </div>
          <ul id="activeTodos" class="mt-2 space-y-2"></ul>
        </div>
      </div>

      <div id="completedTodoList">
        <h2 class="text-xl font-bold text-gray-800 mt-8 mb-4">Completed To-Do</h2>
        <div>
          <div class="flex gap-5">
            <div id="div-selectAllDone" class="hidden">
              <div class="flex gap-1 items-center">
                <input id="select-all-done" type="checkbox" onclick="selectAll(this, 'done')">
                <label for="select-all-done">Select All</label>
              </div>
            </div>
            <div id="options-select-done" class="hidden">
              <div class="flex gap-1">
                <button class="bg-emerald-300 text-white p-1 font-bold hover:cursor-pointer" onclick="markAsBySelected('done', 'active', false)">Mark as active</button>
                <button class="bg-rose-300 text-white p-1 font-bold hover:cursor-pointer" onclick="markAsBySelected('done', null, true)">Delete selected</button>
              </div>
            </div>
          </div>
          <ul id="completedTodos" class="mt-2 space-y-2"></ul>
        </div>
      </div>

      <div id="overdueTodoList">
        <h2 class="text-xl font-bold text-gray-800 mt-8 mb-4">Overdue To-Do</h2>
        <div>
          <div class="flex gap-5">
            <div id="div-selectAllOverdue" class="hidden">
              <div class="flex gap-1 items-center">
                <input id="select-all-overdue" type="checkbox" onclick="selectAll(this, 'overdue')">
                <label for="select-all-overdue">Select All</label>
              </div>
            </div>
            <div id="options-select-overdue" class="hidden">
              <div class="flex gap-1">
                <button class="bg-rose-300 text-white p-1 font-bold hover:cursor-pointer" onclick="markAsBySelected('overdue', null, true)">Delete selected</button>
              </div>
            </div>
          </div>
          <ul id="overdueTodos" class="mt-2 space-y-2"></ul>
        </div>
      </div>
      </div>
  </div>

  <script>
    const nameInput = document.getElementById('name');
    const positionInput = document.getElementById('position');
    const saveUserBtn = document.getElementById('saveUser');

    const todoTitleInput = document.getElementById('todoTitle');
    const todoDetailInput = document.getElementById('todoDetail');
    const todoDateInput = document.getElementById('todoDate');
    const todoDueDateInput = document.getElementById('todoDueDate');
    const todoPriorityInput = document.getElementById('todoPriority');
    const addTodoBtn = document.getElementById('addTodo');

    const activeTodosList = document.getElementById('activeTodos');
    const completedTodosList = document.getElementById('completedTodos');
    const overdueTodosList = document.getElementById('overdueTodos');

    const todos = JSON.parse(localStorage.getItem('todos')) || [];

    function saveUser() {
      const user = {
        name: nameInput.value,
        position: positionInput.value,
      };
      localStorage.setItem('user', JSON.stringify(user));
      alert('User information saved!');
    }

    function addTodo() {
      const newTodo = {
        id: Date.now(),
        title: todoTitleInput.value,
        detail: todoDetailInput.value,
        date: todoDateInput.value,
        dueDate: todoDueDateInput.value,
        priority: todoPriorityInput.value,
        createdAt: new Date().toISOString(),
        status: "active", // active, overdue, completed
      };

      todos.push(newTodo);
      localStorage.setItem('todos', JSON.stringify(todos));
      renderTodos();
      resetForm();
    }

    function renderTodos() {
      activeTodosList.innerHTML = '';
      completedTodosList.innerHTML = '';
      overdueTodosList.innerHTML = '';

      const yesterday = new Date(new Date().getTime() - 24 * 60 * 60 * 1000);

      let countActive = 0;
      let countDone = 0;
      let countOverdue = 0;

      todos.forEach(todo => {
        const li = document.createElement('li');
        li.className = 'p-2 border';
        li.id = `li-todo-${todo.id}`;

        const isOverdue = new Date(todo.dueDate) < yesterday;
        // console.log(yesterday);
        // console.log(new Date(todo.dueDate));
        // console.log(isOverdue);

        let todoDetailHTML = '';
        if (todo.detail) {
          todoDetailHTML += `<p id="todo-detail-${todo.id}" class="p-1 border border-slate-300 text-slate-400 w-fit">${todo.detail}</p>`;
        }

        let markButtonHTML = '';
        if (todo.status == 'done') {
          markButtonHTML = `<button type="button" class="hover:cursor-pointer text-yellow-500" onclick="markAs(${todo.id}, 'active')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 18.75 7.5-7.5 7.5 7.5" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 7.5-7.5 7.5 7.5" />
          </svg></button>`;
        } else if (isOverdue) {
          
        } else {
          markButtonHTML = `<button class="hover:cursor-pointer text-green-500" onclick="markAs(${todo.id}, 'done')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
              </button>`;
        }

        li.innerHTML = `
          <div class="flex justify-between items-center">
            <div class="flex-grow flex items-center gap-1">
              <input id="checkbox-todo-${todo.id}" type="checkbox" name="todo" value="${todo.id}" onclick="selectCertainTodo(this)">
              <div class="flex-grow">
                <p class="font-bold">${todo.title}</p>${todoDetailHTML}
                <div class="flex gap-3 flex-wrap justify-between"><p class="text-gray-500">Priority: ${todo.priority}</p><p class="text-gray-500">Due: ${todo.dueDate}</p></div>
              </div>
            </div>
            <div class="flex gap-1">
              ${markButtonHTML}
              <button class="hover:cursor-pointer text-red-400" onclick="deleteTodo(${todo.id})">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                </svg>
              </button>
            </div>
          </div>
        `;

        let bg_color = "bg-yellow-50";
        let border_color = 'border-yellow-300';
        let todo_detail_bg_color = "bg-yellow-100";
        let set_checkbox_class = "checkbox-active";
        if (todo.status == 'done') {
          completedTodosList.appendChild(li);
          bg_color = "bg-emerald-50";
          border_color = "border-emerald-300";
          todo_detail_bg_color = "border-emerald-400";
          set_checkbox_class = "checkbox-done";
          countDone++;
        } else if (isOverdue) {
          overdueTodosList.appendChild(li);
          bg_color = "bg-rose-50";
          border_color = "border-rose-300";
          todo_detail_bg_color = "border-rose-400";
          set_checkbox_class = "checkbox-overdue";
          todo.status = 'overdue';
          countOverdue++;
        } else {
          activeTodosList.appendChild(li);
          todo.status = 'active';
          countActive++;
        }

        document.getElementById(`li-todo-${todo.id}`).classList.add(bg_color);
        document.getElementById(`li-todo-${todo.id}`).classList.add(border_color);
        if (todo.detail) {
          document.getElementById(`todo-detail-${todo.id}`).classList.add(todo_detail_bg_color);
        }
        document.getElementById(`checkbox-todo-${todo.id}`).classList.add(set_checkbox_class);

        
      });

      if (countActive) {
        document.getElementById('div-selectAllActive').classList.remove('hidden');
      } else {
        document.getElementById('div-selectAllActive').classList.add('hidden');
      }

      if (countDone) {
        document.getElementById('div-selectAllDone').classList.remove('hidden');
      } else {
        document.getElementById('div-selectAllDone').classList.add('hidden');
      }

      if (countOverdue) {
        document.getElementById('div-selectAllOverdue').classList.remove('hidden');
      } else {
        document.getElementById('div-selectAllOverdue').classList.add('hidden');
      }
    }

    function toggleDetails(id) {
      const todo = todos.find(t => t.id === id);
      alert(`Detail: ${todo.detail}`);
    }

    function deleteTodo(id) {
      console.log(id);
      const index = todos.findIndex(t => t.id == id);
      if (index !== -1) {
        todos.splice(index, 1);
        localStorage.setItem('todos', JSON.stringify(todos));
        renderTodos();
      }
    }

    saveUserBtn.addEventListener('click', saveUser);
    addTodoBtn.addEventListener('click', addTodo);
    
    renderTodos();

    /*If user info exist, hide form-user-info*/
    getUserInfo();
    function getUserInfo() {
      const user_info = localStorage.getItem('user');
      // const test = localStorage.getItem('test');
      // console.log(user_info);
      // console.log(test);
      if (user_info) {
        document.getElementById('form-user-info').classList.add('hidden');
        let html_user_info;
      }
    }

  </script>

  <script src="todo.js"></script>
</body>
</html>

<!-- <button class="hover:cursor-pointer text-blue-500 underline" onclick="toggleDetails(${todo.id})">Details</button> -->

